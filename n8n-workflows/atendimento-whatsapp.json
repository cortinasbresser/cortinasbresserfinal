{
    "name": "Atendimento WhatsApp - Cortinas Bresser",
    "nodes": [
        {
            "parameters": {
                "httpMethod": "POST",
                "path": "whatsapp",
                "responseMode": "responseNode",
                "options": {}
            },
            "id": "webhook-whatsapp",
            "name": "Webhook WhatsApp",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 1,
            "position": [
                250,
                300
            ],
            "webhookId": "whatsapp-cortinas"
        },
        {
            "parameters": {
                "conditions": {
                    "string": [
                        {
                            "value1": "={{$json.body.event}}",
                            "operation": "equals",
                            "value2": "messages.upsert"
                        }
                    ]
                }
            },
            "id": "filter-messages",
            "name": "Filtrar Mensagens",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                450,
                300
            ]
        },
        {
            "parameters": {
                "functionCode": "// Extrair dados da mensagem\nconst message = $input.item.json.body.data;\nconst from = message.key.remoteJid;\nconst text = message.message?.conversation || \n             message.message?.extendedTextMessage?.text || '';\n\n// Detectar inten√ß√£o\nlet intent = 'outros';\nlet response = '';\n\nconst textLower = text.toLowerCase();\n\nif (textLower.includes('or√ßamento') || textLower.includes('orcamento')) {\n  intent = 'orcamento';\n  response = `Ol√°! üëã\\n\\nFico feliz em ajudar com seu or√ßamento!\\n\\nPara fazer um or√ßamento personalizado, preciso de algumas informa√ß√µes:\\n\\n1Ô∏è‚É£ Qual tipo de tecido voc√™ prefere?\\n‚Ä¢ Blackout\\n‚Ä¢ Voil\\n‚Ä¢ Linho\\n‚Ä¢ Veludo\\n‚Ä¢ N√£o sei\\n\\nPor favor, me diga qual op√ß√£o voc√™ prefere! üòä`;\n} \nelse if (textLower.includes('pre√ßo') || textLower.includes('preco') || textLower.includes('valor')) {\n  intent = 'preco';\n  response = `üí∞ *Nossos Pre√ßos*\\n\\nNossos valores variam de acordo com:\\n‚Ä¢ Tipo de tecido escolhido\\n‚Ä¢ Tamanho da cortina\\n‚Ä¢ Tipo de instala√ß√£o\\n\\nPara um or√ßamento exato, responda:\\n\"Quero um or√ßamento\"\\n\\nOu ligue: (11) 2692-7865\\n\\n‚ú® Instala√ß√£o GR√ÅTIS em todos os or√ßamentos!`;\n}\nelse if (textLower.includes('prazo') || textLower.includes('entrega') || textLower.includes('demora')) {\n  intent = 'prazo';\n  response = `üöö *Prazos de Entrega*\\n\\n‚Ä¢ Confec√ß√£o: 7 a 10 dias √∫teis\\n‚Ä¢ Instala√ß√£o: Agendamos conforme sua disponibilidade\\n\\n‚úÖ Trabalhamos com confec√ß√£o pr√≥pria\\n‚úÖ Instala√ß√£o GR√ÅTIS inclu√≠da\\n\\nGostaria de fazer um or√ßamento?`;\n}\nelse if (textLower.includes('instala√ß√£o') || textLower.includes('instalacao') || textLower.includes('instalar')) {\n  intent = 'instalacao';\n  response = `üîß *Instala√ß√£o*\\n\\n‚úÖ A instala√ß√£o √© TOTALMENTE GR√ÅTIS!\\n‚úÖ Inclu√≠da em todos os or√ßamentos\\n‚úÖ Feita por profissionais experientes\\n\\nTipos de instala√ß√£o dispon√≠veis:\\n‚Ä¢ Trilho\\n‚Ä¢ Var√£o\\n‚Ä¢ Trilho Motorizado\\n\\nQuer fazer um or√ßamento?`;\n}\nelse if (textLower.includes('hor√°rio') || textLower.includes('horario') || textLower.includes('funciona')) {\n  intent = 'horario';\n  response = `üïê *Hor√°rio de Atendimento*\\n\\nüìç Loja F√≠sica:\\nSegunda a Sexta: 9h √†s 18h\\nS√°bado: 9h √†s 13h\\n\\nüì± WhatsApp:\\nSegunda a Sexta: 9h √†s 18h\\n\\nüìß Email (24h):\\nloja@cortinasbresser.com.br\\n\\nComo posso ajudar?`;\n}\nelse if (textLower.includes('endere√ßo') || textLower.includes('endereco') || textLower.includes('localiza√ß√£o') || textLower.includes('onde')) {\n  intent = 'endereco';\n  response = `üìç *Nossa Localiza√ß√£o*\\n\\nRua Bresser, 1084\\nBr√°s - S√£o Paulo - SP\\nCEP: 03162-030\\n\\nüöá Metr√¥ mais pr√≥ximo:\\nEsta√ß√£o Bresser (Linha 3 - Vermelha)\\n\\nüöó Estacionamento dispon√≠vel\\n\\nVenha nos visitar! üòä`;\n}\nelse if (textLower.includes('tecido') || textLower.includes('tipo') || textLower.includes('modelo')) {\n  intent = 'tecidos';\n  response = `üé® *Tipos de Tecido*\\n\\nTrabalhamos com:\\n\\nüåô *Blackout*\\n‚Ä¢ Bloqueia 100% da luz\\n‚Ä¢ Ideal para quartos\\n\\nüå´Ô∏è *Voil*\\n‚Ä¢ Leve e transl√∫cido\\n‚Ä¢ Deixa luz natural passar\\n\\nüåæ *Linho*\\n‚Ä¢ Elegante e sofisticado\\n‚Ä¢ V√°rias cores dispon√≠veis\\n\\n‚ú® *Veludo*\\n‚Ä¢ Luxuoso e confort√°vel\\n‚Ä¢ √ìtimo isolamento t√©rmico\\n\\nQual te interessa mais?`;\n}\nelse if (textLower.includes('oi') || textLower.includes('ol√°') || textLower.includes('ola') || textLower.includes('bom dia') || textLower.includes('boa tarde') || textLower.includes('boa noite')) {\n  intent = 'saudacao';\n  response = `Ol√°! üëã Bem-vindo √† *Cortinas Bresser*!\\n\\nSou o assistente virtual e estou aqui para ajudar! üòä\\n\\nComo posso te ajudar hoje?\\n\\n‚Ä¢ üõçÔ∏è Fazer um or√ßamento\\n‚Ä¢ üí∞ Consultar pre√ßos\\n‚Ä¢ üöö Informa√ß√µes sobre prazos\\n‚Ä¢ üìè Tipos de tecido\\n‚Ä¢ üìç Nossa localiza√ß√£o\\n\\nDigite sua d√∫vida ou escolha uma op√ß√£o!`;\n}\nelse {\n  intent = 'outros';\n  response = `Desculpe, n√£o entendi sua mensagem. üòÖ\\n\\nPosso ajudar com:\\n\\n‚Ä¢ üõçÔ∏è Or√ßamentos\\n‚Ä¢ üí∞ Pre√ßos\\n‚Ä¢ üöö Prazos de entrega\\n‚Ä¢ üìè Tipos de tecido\\n‚Ä¢ üìç Localiza√ß√£o\\n‚Ä¢ üïê Hor√°rio de atendimento\\n\\nOu se preferir, fale com um atendente:\\nüìû (11) 2692-7865`;\n}\n\nreturn {\n  json: {\n    from: from,\n    text: text,\n    intent: intent,\n    response: response,\n    timestamp: new Date().toISOString()\n  }\n};"
            },
            "id": "detect-intent",
            "name": "Detectar Inten√ß√£o",
            "type": "n8n-nodes-base.function",
            "typeVersion": 1,
            "position": [
                650,
                300
            ]
        },
        {
            "parameters": {
                "url": "={{$env.EVOLUTION_API_URL}}/message/sendText/{{$env.WHATSAPP_INSTANCE_NAME}}",
                "authentication": "genericCredentialType",
                "genericAuthType": "httpHeaderAuth",
                "sendHeaders": true,
                "headerParameters": {
                    "parameters": [
                        {
                            "name": "apikey",
                            "value": "={{$env.EVOLUTION_API_KEY}}"
                        }
                    ]
                },
                "sendBody": true,
                "bodyParameters": {
                    "parameters": [
                        {
                            "name": "number",
                            "value": "={{$json.from}}"
                        },
                        {
                            "name": "text",
                            "value": "={{$json.response}}"
                        }
                    ]
                },
                "options": {}
            },
            "id": "send-response",
            "name": "Enviar Resposta",
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 3,
            "position": [
                850,
                300
            ]
        },
        {
            "parameters": {
                "operation": "insert",
                "schema": "public",
                "table": "leads",
                "columns": "telefone, mensagem, intencao, timestamp",
                "additionalFields": {}
            },
            "id": "save-lead",
            "name": "Salvar Lead",
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 1,
            "position": [
                850,
                500
            ],
            "credentials": {
                "postgres": {
                    "id": "1",
                    "name": "PostgreSQL account"
                }
            }
        },
        {
            "parameters": {
                "conditions": {
                    "string": [
                        {
                            "value1": "={{$json.intent}}",
                            "operation": "equals",
                            "value2": "orcamento"
                        }
                    ]
                }
            },
            "id": "check-orcamento",
            "name": "√â Or√ßamento?",
            "type": "n8n-nodes-base.if",
            "typeVersion": 1,
            "position": [
                1050,
                300
            ]
        },
        {
            "parameters": {
                "fromEmail": "loja@cortinasbresser.com.br",
                "toEmail": "loja@cortinasbresser.com.br",
                "subject": "üîî Novo Lead - Or√ßamento WhatsApp",
                "text": "=Novo lead solicitou or√ßamento via WhatsApp!\n\nTelefone: {{$json.from}}\nMensagem: {{$json.text}}\nHor√°rio: {{$json.timestamp}}\n\nResponda o mais r√°pido poss√≠vel!",
                "options": {}
            },
            "id": "notify-email",
            "name": "Notificar por Email",
            "type": "n8n-nodes-base.emailSend",
            "typeVersion": 2,
            "position": [
                1250,
                200
            ],
            "credentials": {
                "smtp": {
                    "id": "2",
                    "name": "SMTP account"
                }
            }
        },
        {
            "parameters": {
                "respondWith": "json",
                "responseBody": "={{ { \"success\": true, \"message\": \"Mensagem processada\" } }}"
            },
            "id": "response",
            "name": "Response",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1,
            "position": [
                1450,
                300
            ]
        }
    ],
    "connections": {
        "Webhook WhatsApp": {
            "main": [
                [
                    {
                        "node": "Filtrar Mensagens",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Filtrar Mensagens": {
            "main": [
                [
                    {
                        "node": "Detectar Inten√ß√£o",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Detectar Inten√ß√£o": {
            "main": [
                [
                    {
                        "node": "Enviar Resposta",
                        "type": "main",
                        "index": 0
                    },
                    {
                        "node": "Salvar Lead",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Enviar Resposta": {
            "main": [
                [
                    {
                        "node": "√â Or√ßamento?",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "√â Or√ßamento?": {
            "main": [
                [
                    {
                        "node": "Notificar por Email",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Notificar por Email": {
            "main": [
                [
                    {
                        "node": "Response",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        },
        "Salvar Lead": {
            "main": [
                [
                    {
                        "node": "Response",
                        "type": "main",
                        "index": 0
                    }
                ]
            ]
        }
    },
    "settings": {
        "executionOrder": "v1"
    },
    "staticData": null,
    "tags": [],
    "triggerCount": 1,
    "updatedAt": "2025-12-07T23:59:00.000Z",
    "versionId": "1"
}